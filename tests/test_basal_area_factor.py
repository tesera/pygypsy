from pygypsy.basal_area_factor import estimate_basal_area_factor_sw

def test_increment_basal_area_factor_sw():
    bhages = [-26.629227438100003, -25.629227438100003, -24.629227438100003,
              -23.629227438100003, -22.629227438100003, -21.629227438100003,
              -20.629227438100003, -19.629227438100003, -18.629227438100003,
              -17.629227438100003, -16.629227438100003, -15.629227438100001,
              -14.629227438100001, -13.629227438100001, -12.629227438100001,
              -11.629227438100001, -10.629227438100001, -9.6292274381000009,
              -8.6292274381000009, -7.6292274381000009, -6.6292274381000009,
              -5.6292274381000009, -4.6292274381000009, -3.6292274381000009,
              -2.6292274381000009, -1.6292274381000009, -0.62922743810000092,
              0.37077256189999908, 1.3707725618999991, 2.3707725618999991,
              3.3707725618999991, 4.3707725618999991, 5.3707725618999991,
              6.3707725618999991, 7.3707725618999991, 8.3707725618999991,
              9.3707725618999991, 10.370772561899999, 11.370772561899999,
              12.370772561899999, 13.370772561899999, 14.370772561899999,
              15.370772561899999, 16.370772561899997, 17.370772561899997,
              18.370772561899997, 19.370772561899997, 20.370772561899997,
              21.370772561899997, 22.370772561899997, 23.370772561899997,
              24.370772561899997, 25.370772561899997, 26.370772561899997,
              27.370772561899997, 28.370772561899997, 29.370772561899997,
              30.370772561899997, 31.370772561899997, 32.370772561899997,
              33.370772561899997, 34.370772561899997, 35.370772561899997,
              36.370772561899997, 37.370772561899997, 38.370772561899997,
              39.370772561899997, 40.370772561899997, 41.370772561899997,
              42.370772561899997, 43.370772561899997, 44.370772561899997,
              45.370772561899997, 46.370772561899997, 47.370772561899997,
              48.370772561899997, 49.370772561899997, 50.370772561899997,
              51.370772561899997, 52.370772561899997, 53.370772561899997,
              54.370772561899997, 55.370772561899997, 56.370772561899997,
              57.370772561899983, 58.370772561899983, 59.370772561899983,
              60.370772561899983, 61.370772561899983, 62.370772561899983,
              63.370772561899983, 64.370772561899983, 65.370772561899983,
              66.370772561899983, 67.370772561899983, 68.370772561899983,
              69.370772561899983, 70.370772561899983, 71.370772561899983,
              72.370772561899983, 73.370772561899983, 74.370772561899983,
              75.370772561899983, 76.370772561899983, 77.370772561899983,
              78.370772561899983, 79.370772561899983, 80.370772561899983,
              81.370772561899983, 82.370772561899983, 83.370772561899983,
              84.370772561899983, 85.370772561899983, 86.370772561899983,
              87.370772561899983, 88.370772561899983, 89.370772561899983,
              90.370772561899983, 91.370772561899983, 92.370772561899983,
              93.370772561899983, 94.370772561899983, 95.370772561899983,
              96.370772561899983, 97.370772561899983, 98.370772561899983,
              99.370772561899983, 100.37077256189998, 101.37077256189998,
              102.37077256189998, 103.37077256189998, 104.37077256189998,
              105.37077256189998, 106.37077256189998, 107.37077256189998,
              108.37077256189998, 109.37077256189998, 110.37077256189998,
              111.37077256189998, 112.37077256189998, 113.37077256189998,
              114.37077256189998, 115.37077256189998, 116.37077256189998,
              117.37077256189998, 118.37077256189998, 119.37077256189998,
              120.37077256189998, 121.37077256189998, 122.37077256189998,
              123.37077256189998, 124.37077256189998, 125.37077256189998,
              126.37077256189998, 127.37077256189998, 128.3707725619, 129.3707725619,
              130.3707725619, 131.3707725619, 132.3707725619, 133.3707725619,
              134.3707725619, 135.3707725619, 136.3707725619, 137.3707725619,
              138.3707725619, 139.3707725619, 140.3707725619, 141.3707725619,
              142.3707725619, 143.3707725619, 144.3707725619, 145.3707725619,
              146.3707725619, 147.3707725619, 148.3707725619, 149.3707725619,
              150.3707725619, 151.3707725619, 152.3707725619, 153.3707725619,
              154.3707725619, 155.3707725619, 156.3707725619, 157.3707725619,
              158.3707725619, 159.3707725619, 160.3707725619, 161.3707725619,
              162.3707725619, 163.3707725619, 164.3707725619, 165.3707725619,
              166.3707725619, 167.3707725619, 168.3707725619, 169.3707725619,
              170.3707725619, 171.3707725619, 172.3707725619, 173.3707725619,
              174.3707725619, 175.3707725619, 176.3707725619, 177.3707725619,
              178.3707725619, 179.3707725619, 180.3707725619, 181.3707725619,
              182.3707725619, 183.3707725619, 184.3707725619, 185.3707725619,
              186.3707725619, 187.3707725619, 188.3707725619, 189.3707725619,
              190.3707725619, 191.3707725619, 192.3707725619, 193.3707725619,
              194.3707725619, 195.3707725619, 196.3707725619, 197.3707725619,
              198.3707725619, 199.3707725619, 200.3707725619, 201.3707725619,
              202.3707725619, 203.3707725619, 204.3707725619, 205.3707725619,
              206.3707725619, 207.3707725619, 208.3707725619, 209.3707725619,
              210.3707725619, 211.3707725619, 212.3707725619, 213.3707725619,
              214.3707725619, 215.3707725619, 216.3707725619, 217.3707725619,
              218.3707725619, 219.3707725619, 220.3707725619, 221.3707725619]

    old_version_params = {
        'BA_Sw0': 0.001,
        'N0_Sw': 423.23699170300006,
        'startTage': 56,
        'startTageSw': 44.545032732899998,
        'BA_SwT': 2.2156105400000001,
        'N_bh_SwT': 418.18239203000002,
        'SDF_Aw0': 160.4249489,
        'SDF_Pl0': 2224.0681509299998,
        'SDF_Sb0': 0.0,
        'SI_bh_Sw': 6.5731557601199997,
        'SC_Sw': 0.1052773581823121,
        'y2bh_Sw': 15.174260170999998,
    }

    new_params = {
        'BA_Sw0': 0.001,
        'N0_Sw': 423.23699170300006,
        'startTage': 56,
        'BA_SwT': 2.2156105400000001,
        'SDF_Aw0': 160.4249489,
        'SDF_Pl0': 2224.0681509299998,
        'SDF_Sb0': 0.0,
        'SI_bh_Sw': 6.5731557601199997,
        'SC_Sw': 0.1052773581823121,
        'densities': [{'bhage_Sw': i} for i in bhages],
        'N_bh_SwT': 418.18239203000002,
    }
    # 418.18238582658341 is present density as obtained in the densities dicts
    # array, only bhages are provided below and this value hardcoded into
    # sim_basal_area_aw for present_density. NOTE is is close but not identical
    # to the present density in the original!!

    expected = 1.1352489115533175

    import ipdb; ipdb.set_trace()
    result = estimate_basal_area_factor_sw(**new_params)

    assert result == expected
